{% extends "base.html" %}
{% block title %}Calendar{% endblock %}

{% block content %}
<h2 class="mb-3">ðŸ“… Task Calendar</h2>

<div class="card">
    <div id="calendar"></div>
</div>

<!-- Modal -->
<div class="modal fade" id="tasksModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">ðŸ“‹ Tasks on Selected Date</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <ul id="tasksList" class="list-group"></ul>
      </div>
    </div>
  </div>
</div>

<!-- FullCalendar -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function () {

    const calendar = new FullCalendar.Calendar(document.getElementById("calendar"), {
        initialView: "dayGridMonth",
        height: "auto",
        events: "{% url 'task_calendar_events' %}",

        dateClick: function(info) {
            fetch(`/calendar/tasks-by-date/?date=${info.dateStr}`)
                .then(res => res.json())
                .then(data => {
                    const list = document.getElementById("tasksList");
                    list.innerHTML = "";

                    if (data.length === 0) {
                        list.innerHTML = `
                            <li class="list-group-item text-center text-muted">
                                No tasks for this date
                            </li>`;
                    }

                    data.forEach(task => {
                        list.innerHTML += `
                            <li class="list-group-item">
                                <strong>${task.title}</strong><br>
                                <small>
                                    Status: <b>${task.status}</b> |
                                    Priority: <b>${task.priority}</b>
                                </small>
                                <p class="mb-0">${task.description}</p>
                            </li>
                        `;
                    });

                    new bootstrap.Modal(
                        document.getElementById("tasksModal")
                    ).show();
                });
        }
    });

    calendar.render();
});
</script>
{% endblock %}
